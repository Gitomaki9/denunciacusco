<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cusco Reporta – Registro de Usuario</title>

    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/Registro_Usuario.css" />
</head>
<body>

    <header class="topbar">
        <div class="logos">
            <img href="../css/images/CuscoReporta.png" alt="Cusco Reporta">
        </div>
        <nav class="nav">
            <a href="/">Inicio</a>
            <a href="/panel">Registra tu denuncia</a>
            <a href="#">Sobre nosotros</a>
            <a href="/iniciar-sesion">Iniciar Sesión</a>
            <a href="#">Ayuda</a>
        </nav>
    </header>

    <main class="wrap">
        <section class="card">
            <div class="title-area">
                <img class="brand-mini" href="../css/images/CuscoReporta.png" alt="Cusco Reporta">
                <h1>Registro de Usuario</h1>
                <p class="subtitle">Completa tus datos personales para poder reportar incidencias.</p>
            </div>

            <form id="formRegistro" novalidate>
                <div class="grid">
                    <div>
                        <label for="nombre">Nombre completo *</label>
                        <input id="nombre" name="nombre" type="text" placeholder="Ej. Juan Pérez" required>
                        <div id="e-nombre" class="err">Ingrese su nombre completo.</div>
                    </div>

                    <div>
                        <label for="dni">DNI *</label>
                        <input id="dni" name="dni" type="text" inputmode="numeric" maxlength="8" placeholder="8 dígitos" required>
                        <div id="e-dni" class="err">DNI inválido (8 dígitos numéricos).</div>
                    </div>

                    <div>
                        <label for="correo">Correo electrónico *</label>
                        <input id="correo" name="correo" type="email" placeholder="usuario@correo.com" required>
                        <div id="e-correo" class="err">Correo electrónico inválido.</div>
                    </div>

                    <div>
                        <label for="telefono">Teléfono *</label>
                        <input id="telefono" name="telefono" type="text" inputmode="numeric" maxlength="9" placeholder="9 dígitos" required>
                        <div id="e-telefono" class="err">Teléfono inválido (9 dígitos numéricos).</div>
                    </div>

                    <div class="span-2">
                        <label for="direccion">Dirección *</label>
                        <input id="direccion" name="direccion" type="text" placeholder="Av. Los Incas 123, Cusco" required>
                        <div id="e-direccion" class="err">Ingrese su dirección.</div>
                    </div>
                </div>

                <div class="actions">
                    <button type="submit" class="btn">Registrarme</button>
                    <a href="/iniciar-sesion" class="btn secondary">Ya tengo cuenta</a>
                </div>

                <div id="ok" class="success">✅ Registro exitoso. ¡Ahora puedes reportar incidencias!</div>
            </form>

            <p class="disclaimer">
                Al registrarte aceptas los términos y autorizas el uso de tus datos para fines de atención de incidencias de tránsito.
            </p>
        </section>
    </main>

    <script>
        /* MANTENIENDO TU LÓGICA DE BACKEND Y FUNCIONES */
        
        // Sanitiza inputs numéricos (evita espacios y letras) y limita longitud
        const onlyDigits = (el, max) => {
            el.addEventListener('input', () => {
                el.value = el.value.replace(/\D/g,'').slice(0, max);
            });
        };
        onlyDigits(document.getElementById('dni'), 8);
        onlyDigits(document.getElementById('telefono'), 9);

        const f = document.getElementById('formRegistro');
        const ok = document.getElementById('ok');
        const show = (id, on) => document.getElementById(id).style.display = on ? 'block' : 'none';

        f.addEventListener('submit', (e)=>{
            e.preventDefault();
            // Reset de errores
            ['e-nombre','e-dni','e-correo','e-telefono','e-direccion'].forEach(id=>show(id,false));

            const nombre = f.nombre.value.trim();
            const dni = f.dni.value.trim();
            const correo = f.correo.value.trim();
            const tel = f.telefono.value.trim();
            const dir = f.direccion.value.trim();

            let pass = true;
            if(!nombre){ show('e-nombre',true); pass=false; }
            if(!/^\d{8}$/.test(dni)){ show('e-dni',true); pass=false; }
            if(!/^[^@\s]+@[^@\s]+\.[a-zA-Z]{2,}$/.test(correo)){ show('e-correo',true); pass=false; }
            if(!/^\d{9}$/.test(tel)){ show('e-telefono',true); pass=false; }
            if(!dir){ show('e-direccion',true); pass=false; }

            if(pass){
                // Aquí es donde tu backend interactúa:
                // Redirigir a la página de confirmación
                window.location.href = "registro_exitoso.html";
                
                // Estos campos asumen que 'data' vendrá de una respuesta fetch/api futura
                // Se dejan tal cual los tenías para no romper tu integración
                if (typeof data !== 'undefined') {
                    localStorage.setItem("token", data.token);
                    localStorage.setItem("user", JSON.stringify(data.user));
                }
            }
        });
    </script>
    <script href="../css/registro_usuario.js"></script>
</body>
</html>